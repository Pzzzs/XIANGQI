package view;

import javax.swing.*;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.io.File;
import java.io.FileNotFoundException;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.Scanner;

public class FileFrame extends JFrame implements ActionListener {
    private JFileChooser load;
    protected LoadFrame loadFrame;

    public FileFrame(){
        this.setBounds(500,100,600,600);
        this.setDefaultCloseOperation(DISPOSE_ON_CLOSE);
        load = new JFileChooser("D:\\CS102A\\ProjectDemo");
        load.addActionListener(this);
        this.add(load);
        this.setVisible(true);

    }


    @Override
    public void actionPerformed(ActionEvent e) {
        File  file = load.getSelectedFile();
        String name = file.getName();

        if (!name.endsWith(".txt")){
            JOptionPane.showMessageDialog(null,"104");
        }
        else {


            try {
                StringBuilder stringBuilder = new StringBuilder();
                Scanner input = new Scanner(file);
                ArrayList<String> chessboard1 = new ArrayList<>();
                while (input.hasNext()){
                    chessboard1.add(input.nextLine());
                }

                System.out.println(chessboard1);
                if (testchessboard(chessboard1))
                    stringBuilder.append("101 ");
                if (testchess(chessboard1))
                    stringBuilder.append("102 ");
                if (testplayer(chessboard1))
                    stringBuilder.append("103 ");

                String wrongMessage =stringBuilder.toString();

                if (stringBuilder.length()!=0){
                    JOptionPane.showMessageDialog(null,wrongMessage);
                }

                if (stringBuilder.length()==0){
                    ChessGameFrame mainFrame = new ChessGameFrame(1000, 760, chessboard1);
                    mainFrame.setVisible(true);
                    setDefaultCloseOperation(DISPOSE_ON_CLOSE);
                    this.dispose();
                    this.loadFrame.dispose();
                }

            } catch (FileNotFoundException ex) {
                ex.printStackTrace();
            }
        }

    }

    public boolean testchessboard(ArrayList<String> chessboard1) {
        //棋盘长度8*8检查//
        if (chessboard1.size()!=9 && (chessboard1.get(chessboard1.size()-1).charAt(0)=='w' || chessboard1.get(chessboard1.size()-1).charAt(0)=='b')){
            return true;
        }

        for (int i = 0; i < chessboard1.size() -1; i++) {
            if ( chessboard1.get(i).length() != 8){
                return true;
            }
        }
        return false;
    }

    public boolean testchess(ArrayList<String> chessboard1){
        //棋子检查//
        List<Character> chess= Arrays.asList('R','r','K','k','Q','q','B','b','P','p','n','N','_');

        for (int i=0;i<chessboard1.size()-1;i++){
            for (int j=0;j<chessboard1.get(i).length();j++){
                if (!chess.contains(chessboard1.get(i).charAt(j))){
                    return true;
                }
            }
        }

        return false;

    }

    public boolean testplayer(ArrayList<String> chessboard1){
        //缺少下一步行棋方检查//
        if (chessboard1.get(chessboard1.size()-1).charAt(0)!='w' && chessboard1.get(chessboard1.size()-1).charAt(0)!='b'){
            return true;
        }
        return false;

    }

}
